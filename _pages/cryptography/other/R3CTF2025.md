---
permalink: /cryptography/other/R3CTF2025
title: R3CTF 2025
---

<br>

<br>

# ottol r3pus

Challenge:

```python
from Crypto.Util.number import getPrime
from random import randint
import signal

def _handle_timeout(signum, frame):
    raise TimeoutError('function timeout')

timeout = 60
signal.signal(signal.SIGALRM, _handle_timeout)
signal.alarm(timeout)



print("Welcome to ottoL repus.")

bitsize = 1024
flag = open("flag",'r').read()
p,q = getPrime(bitsize // 2),getPrime(bitsize // 2)
score = 0
chances = 0

for _ in range(16):
    print("1. Game Start.")
    print("2. Check score.")
    print("Score:", score)
    coi = int(input())
    
    if coi == 1:
        secret = randint(0, 2 ** 64)
        r1,r2 = randint(0, q), randint(0,p)
        u = randint(0, 2 ** (bitsize // 2))
        v = (secret * 2 ** 128 + randint(0, 2 ** 128)) - u
        x = u + r1 * p
        y = v + r2 * q
        print("x =", x)
        print("y =", y)
        guess = int(input("Give me the secret number: "))
        if guess == secret:
            score += 1
            print("You are smart!")
        else:
            print("~")
    elif coi == 2:
        print("Your scores:", score)
        if score >= 10:
            print(flag)
        else:
            print("Fighting!")
    elif coi == p:
        print("Wtf? You known the real secret number!")
        print(flag)
```


<br>

Cleanup:

```python
from Crypto.Util.number import getPrime

p, q = getPrime(512),getPrime(512)

xs = []
ys = []
for _ in range(6):
    secret = randint(0, 2**64)
    r1, r2 = randint(0, q), randint(0, p)
    u = randint(0, 2**512)
    r3 = randint(0, 2**128)
    v = (secret * 2**128 + r3) - u
    x = u + r1 * p
    y = v + r2 * q
    xs.append(x)
    ys.append(y)

#print(xs)
#print(ys)
```

<br>

Author's solve:

![image](https://github.com/user-attachments/assets/522ea0ff-fb28-4b76-903a-37fd5b1eca8f)

<br>

```python
from os import environ
environ['TERM'] = 'kitty'
from pwn import process, remote
from Crypto.Util.number import isPrime
from re import findall
from tqdm import tqdm
import sys
from itertools import product


range_values = range(-2, 3)
triplets = list(product(range_values, repeat=3))
def Solve(x_v, y_v, n):
    Mxk = Matrix(ZZ, x_v).right_kernel_matrix()
    Myk = Matrix(ZZ, y_v).right_kernel_matrix()
    Lxk = IntegralLattice(identity_matrix(ZZ, n), Mxk)
    Lyk = IntegralLattice(identity_matrix(ZZ, n), Myk)
    Lxyk = Lxk.intersection(Lyk)
    Mxyk = Lxyk.basis_matrix()
    MxykL = Mxyk.LLL()
    Mek = MxykL[:11].right_kernel_matrix()
    m_v = Mek[0]
    Myk = Matrix(ZZ, y_v - m_v).right_kernel_matrix()
    Lyk = IntegralLattice(identity_matrix(ZZ, n), Myk)
    Lxyk = Lxk.intersection(Lyk)
    Mxyk = Lxyk.basis_matrix()
    MxykL = Mxyk.LLL()
    Muk = MxykL[:12].right_kernel_matrix()
    for triple in triplets:
        u_v = vector(triple) * Muk
        p = gcd(list(x_v - u_v))
        if p > 2 ** 100 and isPrime(p):
            return p

while True:
    conn = process(["python", "chall.py"])
    xs = []
    ys = []
    for _ in tqdm(range(15)):
        resp = conn.recvuntil(b"0\n").decode()
        conn.sendline(b"1")
        resp = conn.recvuntil(b"number: ").decode()
        xs.append(int(findall("x = (.*)", resp)[0]))
        ys.append(int(findall("y = (.*)", resp)[0]))
        conn.sendline(b"1")

    x_v = vector(xs)
    y_v = vector(ys)
    resp = conn.recvuntil(b"0\n").decode()
    p = Solve(x_v, y_v, 15)
    print(f'{p = }')
    if p is None:
        conn.close()
        continue
    else:
        conn.sendline(str(p).encode())
        print(conn.recv())
        break
```

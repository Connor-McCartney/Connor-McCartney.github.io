---
permalink: /cryptography/ecc/TheseWallsCodegate2025
title: These Walls - Codegate 2025
---

<br>

<br>

[Challenge Files](https://github.com/Connor-McCartney/CTF_Files/tree/main/2025/codegate/These_Walls)


<br>

```python
from secret import P, s, o, wrong, flag
from Crypto.Cipher import AES
import random, os, math

assert P * o == P.curve()(0)
assert all(math.gcd(o, w) == 1 for w in wrong + [s])
assert all(P * s != P * w for w in wrong)

key = os.urandom(32)
enc_flag = AES.new(key, AES.MODE_CTR, nonce=bytes(12)).encrypt(flag.encode())

print(f"{enc_flag.hex() = }\n{o = }")

key = int.from_bytes(key)
for i in range(32 * 8):
	P *= [random.choice(wrong), s][(key >> i) & 1]
	print(P.xy())
```

<br>

<br>

<br>

# Solve:

Author's writeup: <https://github.com/soon-haari/my-ctf-challenges/tree/main/2025-codegate/crypto-thesewalls>

<br>

<br>

# 1. Getting curve parameters

You can do something like this: <https://hackropole.fr/en/writeups/fcsc2021-crypto-lost-curve/984a2038-3039-42c2-af1b-8d671c8d5cb0/>

```
wget https://raw.githubusercontent.com/soon-haari/my-ctf-challenges/refs/heads/main/2025-codegate/crypto-thesewalls/prob/for_organizer/output.txt
```

<br>

```python
points = [[int(i) for i in line.strip()[1:-1].split(', ')] for line in open('output.txt').readlines()[2:]]


PR.<a, b> = PolynomialRing(ZZ)
eqs = []
for x, y in points:
    eqs.append(x^3 + a * x + b - y^2)
for eq in Ideal(eqs).groebner_basis():
    print(eq)

modulus = 102426836944425277819174256940128868455066517869185115488781035394164877927042198980921397582250905694209313963017944880679709788694772632564808279062807699845761214703586660326307989151472431126842544189892251409194318824261554131269698538462346988910692541060196190265045309883144365795763912362099350625483
a = -42437997016440510106912234059113681926759694788505021671714484006715784960406807326337661210536581463443414294141888675487947253004723175974512262085287744401565107056353588589043894055035481272184124372125833792185916608297835874449349134631410453080264719245505015377542883012707703282190702361267129303085 
b = -459126200632887849752040227678358886031820038366770963884159263686486524398810848612517185164748716420888346292004054958933940038260166360595786900336024132100453336182502034941923082615662562466591523855797071255915619970830634702916789796993677327554098916574862778060640867963470961569155246282541122528
print(a % modulus)
print(b % modulus)
```

So:

```
modulus = 102426836944425277819174256940128868455066517869185115488781035394164877927042198980921397582250905694209313963017944880679709788694772632564808279062807699845761214703586660326307989151472431126842544189892251409194318824261554131269698538462346988910692541060196190265045309883144365795763912362099350625483

a = 59988839927984767712262022881015186528306823080680093817066551387449092966635391654583736371714324230765899668876056205191762535690049456590296016977519955444196107647233071737264095096436949854658419817766417617008402215963718256820349403830936535830427821814691174887502426870436662513573210000832221322398

b = 101967710743792389969422216712450509569034697830818344524896876130478391402643388132308880397086156977788425616725940825720775848656512466204212492162471675713660761367404158291366066068856768564375952666036454337938403204290723496566781748665353311583138442143621327486984669015180894834194757115816809502955
```

<br>

# 2. Factor the modulus

You can check the author's code how to do it, the result is:

```
modulus = 102426836944425277819174256940128868455066517869185115488781035394164877927042198980921397582250905694209313963017944880679709788694772632564808279062807699845761214703586660326307989151472431126842544189892251409194318824261554131269698538462346988910692541060196190265045309883144365795763912362099350625483
p1 = 3562548874780288796769030192977
p2 = 3692983360407686094702508373879
p3 = 2717597692908121319788497985451
p4 = 324094280281900209908870811008292068290746348301400744740589987
assert modulus == p1 * p2**2 * p3**3 * p4**2
```

<br>

Now we'll split this into 4 different curves with the different primes. 

<br>

# 3. p1 - singular curve (elliptic node)

same as <https://connor-mccartney.github.io/cryptography/ecc/Backdoor-IRONCTF2024>

<br>

```python
from collections import namedtuple
Point = namedtuple("Point", "x y")
O = 'Origin'

def point_inverse(P):
    if P == O:
        return P
    return Point(P.x, -P.y % p)

def point_addition(P, Q):
    if P == O:
        return Q
    elif Q == O:
        return P
    elif Q == point_inverse(P):
        return O
    else:
        if P == Q:
            lam = (3*P.x**2 + a)*pow(2*P.y, -1, p)
            lam %= p
        else:
            lam = (Q.y - P.y) * pow((Q.x - P.x), -1, p)
            lam %= p
    Rx = (lam**2 - P.x - Q.x) % p
    Ry = (lam*(P.x - Rx) - P.y) % p
    R = Point(Rx, Ry)
    return R

def mul(P, n):
    Q = P
    R = O
    while n > 0:
        if n % 2 == 1:
            R = point_addition(R, Q)
        Q = point_addition(Q, Q)
        n = n // 2
    return R.x


def node_log(p, a, b, qx, qy, sx, sy):
    PR.<x> = PolynomialRing(GF(p))
    f = x^3 + a*x + b
    double_root = [r for r, e in f.roots() if e==2][0]
    qx -= double_root
    sx -= double_root 
    f2 = f.subs(x=x+double_root)
    c = f2.factor()[0][0].coefficients()[0]
    sqrt_c = GF(p)(c).sqrt()
    def mapping(x, y, sqrt_c):
        return (y + x*sqrt_c) * pow(y - x*sqrt_c, -1, p)
    return mapping(sx, sy, sqrt_c).log(mapping(qx, qy, sqrt_c))

points = [[int(i) for i in line.strip()[1:-1].split(', ')] for line in open('output.txt').readlines()[2:]]

p = 3562548874780288796769030192977
a = 59988839927984767712262022881015186528306823080680093817066551387449092966635391654583736371714324230765899668876056205191762535690049456590296016977519955444196107647233071737264095096436949854658419817766417617008402215963718256820349403830936535830427821814691174887502426870436662513573210000832221322398
b = 101967710743792389969422216712450509569034697830818344524896876130478391402643388132308880397086156977788425616725940825720775848656512466204212492162471675713660761367404158291366066068856768564375952666036454337938403204290723496566781748665353311583138442143621327486984669015180894834194757115816809502955

cache = set()
#cache = set([2419208789977833651231607199477, 2583035536321228815355660114783, 1296865482336368230445011996195, 501301829518150467387924489803, 1596507685543054568030561590627, 1189472469521133536636628876539, 1688818121111580066310934554129, 3127040603798222765320841880913, 1313812976397865456124720849605, 2450964906071836807094736013303])
for i in range(255):
    P1 = Point(points[i][0], points[i][1])
    P2 = Point(points[i+1][0], points[i+1][1])
    log = None
    for l in cache:
        if mul(P1, l) == P2.x % p:
            log = l
            break
    if log is None:
        log = node_log(p, a, b, P1.x,P1.y, P2.x, P2.y)
    cache.add(log)
    print(log)
```

<br>


```
[1688818121111580066310934554129, 1688818121111580066310934554129, 1688818121111580066310934554129, 1688818121111580066310934554129, 1688818121111580066310934554129, 1688818121111580066310934554129, 1596507685543054568030561590627, 3127040603798222765320841880913, 1688818121111580066310934554129, 1688818121111580066310934554129, 1688818121111580066310934554129, 1688818121111580066310934554129, 1688818121111580066310934554129, 1688818121111580066310934554129, 1688818121111580066310934554129, 1688818121111580066310934554129, 1688818121111580066310934554129, 2450964906071836807094736013303, 1688818121111580066310934554129, 1296865482336368230445011996195, 1688818121111580066310934554129, 1688818121111580066310934554129, 1189472469521133536636628876539, 1688818121111580066310934554129, 1688818121111580066310934554129, 1688818121111580066310934554129, 1688818121111580066310934554129, 1688818121111580066310934554129, 1688818121111580066310934554129, 1189472469521133536636628876539, 1688818121111580066310934554129, 1688818121111580066310934554129, 1688818121111580066310934554129, 1688818121111580066310934554129, 2419208789977833651231607199477, 1688818121111580066310934554129, 1688818121111580066310934554129, 1688818121111580066310934554129, 3127040603798222765320841880913, 1688818121111580066310934554129, 1688818121111580066310934554129, 1688818121111580066310934554129, 1688818121111580066310934554129, 501301829518150467387924489803, 1688818121111580066310934554129, 2419208789977833651231607199477, 1296865482336368230445011996195, 1688818121111580066310934554129, 3127040603798222765320841880913, 2419208789977833651231607199477, 1688818121111580066310934554129, 1688818121111580066310934554129, 1688818121111580066310934554129, 1688818121111580066310934554129, 1688818121111580066310934554129, 1296865482336368230445011996195, 1688818121111580066310934554129, 1688818121111580066310934554129, 2419208789977833651231607199477, 1688818121111580066310934554129, 1688818121111580066310934554129, 1189472469521133536636628876539, 1296865482336368230445011996195, 1688818121111580066310934554129, 501301829518150467387924489803, 1688818121111580066310934554129, 1688818121111580066310934554129, 3127040603798222765320841880913, 1688818121111580066310934554129, 1688818121111580066310934554129, 1688818121111580066310934554129, 1688818121111580066310934554129, 1688818121111580066310934554129, 2450964906071836807094736013303, 1688818121111580066310934554129, 1688818121111580066310934554129, 1688818121111580066310934554129, 1596507685543054568030561590627, 1688818121111580066310934554129, 1688818121111580066310934554129, 1688818121111580066310934554129, 1688818121111580066310934554129, 1688818121111580066310934554129, 1688818121111580066310934554129, 1688818121111580066310934554129, 1688818121111580066310934554129, 1688818121111580066310934554129, 1688818121111580066310934554129, 1688818121111580066310934554129, 1688818121111580066310934554129, 1596507685543054568030561590627, 1688818121111580066310934554129, 2583035536321228815355660114783, 1688818121111580066310934554129, 1688818121111580066310934554129, 1688818121111580066310934554129, 1688818121111580066310934554129, 1688818121111580066310934554129, 1688818121111580066310934554129, 2419208789977833651231607199477, 1688818121111580066310934554129, 1313812976397865456124720849605, 1688818121111580066310934554129, 1688818121111580066310934554129, 1688818121111580066310934554129, 1296865482336368230445011996195, 1688818121111580066310934554129, 1688818121111580066310934554129, 1313812976397865456124720849605, 1688818121111580066310934554129, 1688818121111580066310934554129, 1688818121111580066310934554129, 1688818121111580066310934554129, 1688818121111580066310934554129, 1688818121111580066310934554129, 1688818121111580066310934554129, 1688818121111580066310934554129, 1688818121111580066310934554129, 1596507685543054568030561590627, 1688818121111580066310934554129, 1688818121111580066310934554129, 1688818121111580066310934554129, 2450964906071836807094736013303, 1688818121111580066310934554129, 1688818121111580066310934554129, 501301829518150467387924489803, 1688818121111580066310934554129, 3127040603798222765320841880913, 1688818121111580066310934554129, 1688818121111580066310934554129, 3127040603798222765320841880913, 1688818121111580066310934554129, 1688818121111580066310934554129, 1688818121111580066310934554129, 1688818121111580066310934554129, 1688818121111580066310934554129, 1688818121111580066310934554129, 1688818121111580066310934554129, 1688818121111580066310934554129, 1688818121111580066310934554129, 1688818121111580066310934554129, 1688818121111580066310934554129, 1688818121111580066310934554129, 1688818121111580066310934554129, 1688818121111580066310934554129, 1688818121111580066310934554129, 2419208789977833651231607199477, 1688818121111580066310934554129, 1688818121111580066310934554129, 1688818121111580066310934554129, 1688818121111580066310934554129, 1189472469521133536636628876539, 1688818121111580066310934554129, 1688818121111580066310934554129, 1688818121111580066310934554129, 1688818121111580066310934554129, 2450964906071836807094736013303, 2450964906071836807094736013303, 1688818121111580066310934554129, 1688818121111580066310934554129, 1688818121111580066310934554129, 1688818121111580066310934554129, 1688818121111580066310934554129, 1596507685543054568030561590627, 1688818121111580066310934554129, 1688818121111580066310934554129, 1688818121111580066310934554129, 1688818121111580066310934554129, 1688818121111580066310934554129, 1688818121111580066310934554129, 1688818121111580066310934554129, 1688818121111580066310934554129, 1688818121111580066310934554129, 1688818121111580066310934554129, 1688818121111580066310934554129, 3127040603798222765320841880913, 1688818121111580066310934554129, 1688818121111580066310934554129, 1688818121111580066310934554129, 1688818121111580066310934554129, 1688818121111580066310934554129, 2419208789977833651231607199477, 1688818121111580066310934554129, 1688818121111580066310934554129, 1688818121111580066310934554129, 1688818121111580066310934554129, 1688818121111580066310934554129, 1688818121111580066310934554129, 1688818121111580066310934554129, 1688818121111580066310934554129, 1688818121111580066310934554129, 1688818121111580066310934554129, 1688818121111580066310934554129, 1688818121111580066310934554129, 1688818121111580066310934554129, 1688818121111580066310934554129, 1688818121111580066310934554129, 1688818121111580066310934554129, 1688818121111580066310934554129, 1688818121111580066310934554129, 1688818121111580066310934554129, 1688818121111580066310934554129, 1596507685543054568030561590627, 1688818121111580066310934554129, 1313812976397865456124720849605, 2450964906071836807094736013303, 1688818121111580066310934554129, 1688818121111580066310934554129, 1688818121111580066310934554129, 1688818121111580066310934554129, 1688818121111580066310934554129, 1688818121111580066310934554129, 1189472469521133536636628876539, 1688818121111580066310934554129, 1688818121111580066310934554129, 1688818121111580066310934554129, 1688818121111580066310934554129, 1688818121111580066310934554129, 1688818121111580066310934554129, 1688818121111580066310934554129, 1688818121111580066310934554129, 1688818121111580066310934554129, 1688818121111580066310934554129, 1296865482336368230445011996195, 3127040603798222765320841880913, 501301829518150467387924489803, 1688818121111580066310934554129, 1189472469521133536636628876539, 1688818121111580066310934554129, 1688818121111580066310934554129, 1688818121111580066310934554129, 1296865482336368230445011996195, 1688818121111580066310934554129, 1688818121111580066310934554129, 1688818121111580066310934554129, 1688818121111580066310934554129, 1688818121111580066310934554129, 2583035536321228815355660114783, 1688818121111580066310934554129, 1688818121111580066310934554129, 1688818121111580066310934554129, 1688818121111580066310934554129, 2419208789977833651231607199477, 1688818121111580066310934554129, 1313812976397865456124720849605, 2419208789977833651231607199477, 1688818121111580066310934554129, 1688818121111580066310934554129, 1688818121111580066310934554129, 1688818121111580066310934554129, 1688818121111580066310934554129, 1688818121111580066310934554129, 1688818121111580066310934554129, 1688818121111580066310934554129, 1688818121111580066310934554129]
```

<br>

# 3. p2 - supersingular curve (MOV attack)

```python
p2 = 3692983360407686094702508373879
a = 59988839927984767712262022881015186528306823080680093817066551387449092966635391654583736371714324230765899668876056205191762535690049456590296016977519955444196107647233071737264095096436949854658419817766417617008402215963718256820349403830936535830427821814691174887502426870436662513573210000832221322398
b = 101967710743792389969422216712450509569034697830818344524896876130478391402643388132308880397086156977788425616725940825720775848656512466204212492162471675713660761367404158291366066068856768564375952666036454337938403204290723496566781748665353311583138442143621327486984669015180894834194757115816809502955
E = EllipticCurve(GF(p2), [a, b])

# embedding degree
k = 1
while (p2**k - 1) % E.order() != 0:
    k += 1
print(k)
```

<br>

The embedding degree is 2. 

<br.

